{"ast":null,"code":"var _jsxFileName = \"/Users/user/Desktop/sizl/mono_pop/packages/basic/src/container/BasicAuthority.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState } from 'react';\nimport { ExcelTable, Header as PageHeader, RequestMethod, MAX_VALUE, TextEditor } from 'shared'; // @ts-ignore\n\nimport Notiflix from \"notiflix\";\nimport { useRouter } from 'next/router';\nimport TreeViewTable from '../../../main/component/TreeView/TreeView';\nimport { AUTHORITY_LIST } from '../../../main/common/configset';\nimport styled from 'styled-components';\nconst title = '권한 관리';\n\nconst BasicAuthority = ({\n  page,\n  keyword,\n  option\n}) => {\n  const {\n    0: row,\n    1: setRow\n  } = useState([]);\n  const {\n    0: auth,\n    1: setAuth\n  } = useState(AUTHORITY_LIST);\n  const {\n    0: selectIndex,\n    1: setSelectIndex\n  } = useState(-1);\n  const router = useRouter();\n  useEffect(() => {\n    loadAuthorityList().then(() => Notiflix.Loading.remove());\n  }, []);\n\n  const loadAuthorityList = async () => {\n    Notiflix.Loading.circle();\n    const res = await RequestMethod('get', 'authorityList', {\n      path: {\n        page: 1,\n        renderItem: MAX_VALUE\n      }\n    });\n\n    if (res && res.status === 200) {\n      setRow([...res.results.info_list]);\n    } else if (res.state === 401) {\n      Notiflix.Report.failure('불러올 수 없습니다.', '권한이 없습니다.', '확인', () => {\n        router.back();\n      });\n    }\n  };\n\n  const changeListToAuth = list => {\n    let tmpMenu = auth;\n\n    const MenuDivide = dmenu => {\n      let tmp = dmenu;\n      if (tmp.value) tmp.check = list.indexOf(tmp.value) !== -1; // using stack structure, recursively add authorities\n\n      tmp.child = tmp.child.map(inner => MenuDivide(inner));\n      let cnt = 0;\n\n      if (tmp.child.length !== 0) {\n        tmp.child.map(inner => {\n          if (inner.check) cnt++;\n        });\n        tmp.check = tmp.child.length === cnt;\n      }\n\n      return tmp;\n    };\n\n    tmpMenu = tmpMenu.map(menu => MenuDivide(menu));\n    setAuth([...tmpMenu]);\n  };\n\n  const changeAuthToList = index => {\n    let tmpAuth = [];\n\n    const checkAuth = dmenu => {\n      if (dmenu.value && dmenu.checkable && dmenu.check) {\n        tmpAuth.push(dmenu.value);\n      }\n\n      dmenu.child.map(inner => {\n        return checkAuth(inner);\n      });\n    };\n\n    auth.map(menu => {\n      checkAuth(menu);\n    });\n    return tmpAuth;\n  };\n\n  const updateAuth = async data => {\n    if (data.ca_id) {\n      const updatedAuthorities = changeAuthToList(data.authorities);\n      await RequestMethod('put', 'authorityUpdate', _objectSpread(_objectSpread({}, data), {}, {\n        authorities: updatedAuthorities\n      })).then(async res => {\n        if (res.status === 200) {\n          await new Promise(resolve => {\n            changeListToAuth(updatedAuthorities); // update row datum\n\n            let temporaryRows = row;\n            temporaryRows[selectIndex].authorities = updatedAuthorities;\n            setRow([...temporaryRows]);\n            resolve(true);\n          }).then(() => Notiflix.Report.success('저장 성공!', '권한이 성공적으로 변경됐습니다.', '확인', () => {\n            loadAuthorityList().then(() => Notiflix.Loading.remove());\n          }));\n        }\n      });\n    }\n  };\n\n  const createAuth = async data => {\n    if (data) {\n      const addedAuthorities = changeAuthToList(data.authorities);\n      const res = await RequestMethod('post', 'authorityCreate', {\n        name: data.name,\n        authorities: addedAuthorities\n      });\n\n      if (res.status === 200) {\n        await new Promise(resolve => {\n          changeListToAuth(addedAuthorities); // update row datum\n\n          let temporaryRows = row;\n          temporaryRows[selectIndex].authorities = addedAuthorities;\n          setRow([...temporaryRows]);\n          resolve(true);\n        }).then(() => Notiflix.Report.success('저장 성공!', '권한이 성공적으로 등록됐습니다.', '확인', () => {\n          loadAuthorityList().then(() => Notiflix.Loading.remove());\n        }));\n      }\n    } else {\n      Notiflix.Report.failure('권한 없음', '권한을 선택해주세요', '확인');\n    }\n  };\n\n  const deleteAuth = async () => {\n    if (selectIndex !== -1 && row[selectIndex].ca_id) {\n      const res = await RequestMethod('delete', 'authorityDelete', {\n        ca_id: row[selectIndex].ca_id\n      });\n\n      if (res.status === 200) {\n        Notiflix.Report.success('삭제 성공!', '권한이 성공적으로 삭제됐습니다.', '확인', () => {\n          loadAuthorityList().then(() => {\n            Notiflix.Loading.remove();\n          });\n        });\n      }\n    } else {\n      let tmpRow = row;\n      tmpRow.splice(selectIndex, 1);\n      setRow([...tmpRow]);\n    }\n\n    setSelectIndex(-1);\n  };\n\n  const addRow = () => {\n    setRow([...row, {\n      ca_id: \"\",\n      name: '',\n      authorities: []\n    }]);\n  };\n\n  const leftButtonOnClick = index => {\n    switch (index) {\n      case 0:\n        return addRow();\n\n      case 1:\n        return deleteAuth();\n    }\n  };\n\n  const saveAppointmentAuthorityDetails = async () => {\n    Notiflix.Loading.hourglass('권한을 저장하고 있습니다..');\n    new Promise(async resolve => {\n      if (selectIndex !== -1 && row[selectIndex].ca_id) {\n        await updateAuth(row[selectIndex]);\n      } else {\n        await createAuth(row[selectIndex]);\n      }\n\n      resolve(true);\n    }).then(() => Notiflix.Loading.remove(1000));\n  };\n\n  useEffect(() => {\n    console.log(row);\n  }, [row]);\n  return __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 5\n    }\n  }, __jsx(PageHeader, {\n    title: title,\n    buttonsOnclick: saveAppointmentAuthorityDetails,\n    leftButtonOnClick: leftButtonOnClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }\n  }), __jsx(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'space-between',\n      paddingRight: 40,\n      marginBottom: 16\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    style: {\n      display: 'flex'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 9\n    }\n  }, __jsx(HeaderButton, {\n    style: {\n      marginLeft: 0\n    },\n    onClick: () => addRow(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 11\n    }\n  }, '행추가'), __jsx(HeaderButton, {\n    onClick: () => deleteAuth(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 11\n    }\n  }, '삭제')), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 9\n    }\n  }, __jsx(HeaderButton, {\n    onClick: () => saveAppointmentAuthorityDetails(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 11\n    }\n  }, '저장하기'))), __jsx(\"div\", {\n    style: {\n      display: 'flex'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    style: {\n      marginRight: 30\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 9\n    }\n  }, __jsx(ExcelTable, {\n    clickable: true,\n    width: 280,\n    headerList: [{\n      key: 'name',\n      width: 280,\n      name: '권한명',\n      editor: TextEditor\n    }],\n    row: row,\n    setRow: row => setRow([...row]),\n    setSelectRow: index => {\n      var _row$index$authoritie;\n\n      changeListToAuth((_row$index$authoritie = row[index].authorities) !== null && _row$index$authoritie !== void 0 ? _row$index$authoritie : []);\n      setSelectIndex(index);\n      setRow([...row.map((v, i) => {\n        if (index === i) {\n          return _objectSpread(_objectSpread({}, v), {}, {\n            border: true\n          });\n        } else {\n          return _objectSpread(_objectSpread({}, v), {}, {\n            border: false\n          });\n        }\n      })]);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 11\n    }\n  })), __jsx(TreeViewTable, {\n    item: auth,\n    setItem: setAuth,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 9\n    }\n  })));\n};\n\nconst HeaderButton = styled.button`\n    height:32px;\n    color:white;\n    border-radius:6px;\n    font-size:15px;\n    font-weight:bold;\n    background:#717C90;\n    padding: 0 20px;\n    cursor: pointer;\n    display:flex;\n    margin-left: 16px;\n    justify-content:center;\n    align-items:center;\n`;\nexport { BasicAuthority };","map":{"version":3,"sources":["/Users/user/Desktop/sizl/mono_pop/packages/basic/src/container/BasicAuthority.tsx"],"names":["React","useEffect","useState","ExcelTable","Header","PageHeader","RequestMethod","MAX_VALUE","TextEditor","Notiflix","useRouter","TreeViewTable","AUTHORITY_LIST","styled","title","BasicAuthority","page","keyword","option","row","setRow","auth","setAuth","selectIndex","setSelectIndex","router","loadAuthorityList","then","Loading","remove","circle","res","path","renderItem","status","results","info_list","state","Report","failure","back","changeListToAuth","list","tmpMenu","MenuDivide","dmenu","tmp","value","check","indexOf","child","map","inner","cnt","length","menu","changeAuthToList","index","tmpAuth","checkAuth","checkable","push","updateAuth","data","ca_id","updatedAuthorities","authorities","Promise","resolve","temporaryRows","success","createAuth","addedAuthorities","name","deleteAuth","tmpRow","splice","addRow","leftButtonOnClick","saveAppointmentAuthorityDetails","hourglass","console","log","display","justifyContent","paddingRight","marginBottom","marginLeft","marginRight","key","width","editor","v","i","border","HeaderButton","button"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react'\nimport {\n  ExcelTable,\n  Header as PageHeader,\n  RequestMethod,\n  columnlist,\n  MAX_VALUE,\n  DropDownEditor,\n  TextEditor,\n  excelDownload,\n  PaginationComponent,\n  ExcelDownloadModal,\n  IExcelHeaderType, IItemMenuType\n} from 'shared'\n// @ts-ignore\nimport {SelectColumn} from 'react-data-grid'\nimport Notiflix from \"notiflix\";\nimport {useRouter} from 'next/router'\nimport {loadAll} from 'react-cookies'\nimport {NextPageContext} from 'next'\nimport TreeViewTable from '../../../main/component/TreeView/TreeView'\nimport {IMenu} from '../../../main/common/@types/type'\nimport {AUTHORITY_LIST} from '../../../main/common/configset'\nimport {AxiosResponse} from 'axios'\nimport styled from 'styled-components'\n\nexport interface IProps {\n  children?: any\n  page?: number\n  keyword?: string\n  option?: number\n}\n\nconst title = '권한 관리'\n\nconst BasicAuthority = ({page, keyword, option}: IProps) => {\n  const [row, setRow] = useState<Array<any>>([])\n  const [auth, setAuth] = useState<Array<IMenu>>(AUTHORITY_LIST)\n  const [selectIndex, setSelectIndex] = useState<number>(-1)\n\n  const router = useRouter()\n\n  useEffect(() => {\n    loadAuthorityList().then(() => Notiflix.Loading.remove())\n  }, [])\n\n  const loadAuthorityList = async () => {\n    Notiflix.Loading.circle()\n    const res = await RequestMethod('get', 'authorityList',\n      {\n        path: {\n          page: 1,\n          renderItem: MAX_VALUE\n        }\n      })\n\n    if(res && res.status === 200) {\n      setRow([...res.results.info_list])\n    }else if (res.state === 401) {\n      Notiflix.Report.failure('불러올 수 없습니다.', '권한이 없습니다.', '확인', () => {\n        router.back()\n      })\n    }\n  }\n\n  const changeListToAuth = (list: string[]) => {\n    let tmpMenu = auth\n    const MenuDivide = (dmenu: IMenu) => {\n      let tmp = dmenu\n      if (tmp.value) tmp.check = list.indexOf(tmp.value) !== -1;\n      // using stack structure, recursively add authorities\n      tmp.child = tmp.child.map(inner => MenuDivide(inner))\n\n      let cnt = 0\n      if (tmp.child.length !== 0) {\n        tmp.child.map(inner => {\n          if (inner.check) cnt++\n        })\n        tmp.check = tmp.child.length === cnt;\n      }\n\n      return tmp\n    }\n\n    tmpMenu = tmpMenu.map(menu => MenuDivide(menu))\n    setAuth([...tmpMenu])\n  }\n\n  const changeAuthToList = (index: number) => {\n    let tmpAuth: string[] = []\n\n    const checkAuth = (dmenu: IMenu) => {\n      if(dmenu.value && dmenu.checkable && dmenu.check) {\n        tmpAuth.push(dmenu.value)\n      }\n\n      dmenu.child.map(inner => {\n        return checkAuth(inner)\n      })\n    }\n\n    auth.map(menu => {\n      checkAuth(menu)\n    })\n\n    return tmpAuth\n  }\n\n  const updateAuth = async (data: any) => {\n    if(data.ca_id){\n      const updatedAuthorities = changeAuthToList(data.authorities)\n      await RequestMethod('put', 'authorityUpdate', {\n        ...data,\n        authorities: updatedAuthorities\n      }).then(async (res: AxiosResponse) => {\n        if (res.status === 200){\n          await new Promise((resolve) => {\n            changeListToAuth(updatedAuthorities)\n            // update row datum\n            let temporaryRows = row\n            temporaryRows[selectIndex].authorities = updatedAuthorities\n            setRow([ ...temporaryRows])\n            resolve(true)\n          }).then(() =>Notiflix.Report.success('저장 성공!', '권한이 성공적으로 변경됐습니다.', '확인', () => {\n            loadAuthorityList().then(() => Notiflix.Loading.remove())\n          }))\n        }\n      })\n    }\n  }\n\n  const createAuth = async (data: any) => {\n    if(data){\n      const addedAuthorities = changeAuthToList(data.authorities)\n      const res = await RequestMethod('post', 'authorityCreate', {\n        name: data.name,\n        authorities: addedAuthorities\n      })\n\n      if (res.status === 200){\n        await new Promise((resolve) => {\n          changeListToAuth(addedAuthorities)\n          // update row datum\n          let temporaryRows = row\n          temporaryRows[selectIndex].authorities = addedAuthorities\n          setRow([ ...temporaryRows])\n          resolve(true)\n        }).then(() => Notiflix.Report.success('저장 성공!', '권한이 성공적으로 등록됐습니다.', '확인', () => {\n          loadAuthorityList().then(() => Notiflix.Loading.remove())\n        }))\n      }\n    } else {\n      Notiflix.Report.failure('권한 없음', '권한을 선택해주세요', '확인')\n    }\n  }\n\n  const deleteAuth = async () => {\n    if(selectIndex !== -1 && row[selectIndex].ca_id){\n      const res = await RequestMethod('delete', 'authorityDelete', {\n        ca_id: row[selectIndex].ca_id\n      })\n\n      if (res.status === 200){\n        Notiflix.Report.success('삭제 성공!', '권한이 성공적으로 삭제됐습니다.', '확인', () => {\n          loadAuthorityList().then(() => {\n            Notiflix.Loading.remove()\n          })\n        })\n      }\n    } else {\n      let tmpRow = row\n      tmpRow.splice(selectIndex, 1)\n\n      setRow([...tmpRow])\n    }\n    setSelectIndex(-1)\n  }\n\n  const addRow = () => {\n    setRow([...row, {\n      ca_id: \"\",\n      name: '',\n      authorities: []\n    }])\n  }\n\n  const leftButtonOnClick = (index: number) => {\n    switch(index){\n      case 0:\n        return addRow()\n      case 1:\n        return deleteAuth()\n    }\n  }\n\n  const saveAppointmentAuthorityDetails = async () => {\n    Notiflix.Loading.hourglass('권한을 저장하고 있습니다..')\n    new Promise( async (resolve) => {\n      if (selectIndex !== -1 && row[selectIndex].ca_id) {\n        await updateAuth(row[selectIndex])\n      } else {\n        await createAuth(row[selectIndex])\n      }\n      resolve(true)\n    }).then(() => Notiflix.Loading.remove(1000))\n  }\n\n  useEffect(() => {\n    console.log(row)\n  }, [row])\n\n  return (\n    <div>\n      <PageHeader\n        title={title}\n        buttonsOnclick={saveAppointmentAuthorityDetails}\n        leftButtonOnClick={leftButtonOnClick}\n      />\n      <div style={{display: 'flex', justifyContent: 'space-between', paddingRight: 40, marginBottom: 16}}>\n        <div style={{display: 'flex'}}>\n          <HeaderButton style={{marginLeft: 0}} onClick={() => addRow()}>\n            {'행추가'}\n          </HeaderButton>\n          <HeaderButton onClick={() => deleteAuth()}>\n            {'삭제'}\n          </HeaderButton>\n        </div>\n        <div>\n          <HeaderButton onClick={() => saveAppointmentAuthorityDetails()}>\n            {'저장하기'}\n          </HeaderButton>\n        </div>\n      </div>\n      <div style={{display: 'flex'}}>\n        <div style={{marginRight: 30}}>\n          <ExcelTable\n            clickable\n            width={280}\n            headerList={[{key: 'name', width: 280, name: '권한명', editor: TextEditor},]}\n            row={row}\n            setRow={(row) => setRow([...row])}\n            setSelectRow={(index) => {\n              changeListToAuth(row[index].authorities ?? [])\n              setSelectIndex(index)\n              setRow([...row.map((v, i) => {\n                if(index === i){\n                  return {\n                    ...v,\n                    border: true,\n                  }\n                }else{\n                  return {\n                    ...v,\n                    border: false,\n                  }\n                }\n              })])\n            }}\n          />\n        </div>\n        <TreeViewTable item={auth} setItem={setAuth} />\n      </div>\n    </div>\n  );\n}\n\nconst HeaderButton = styled.button`\n    height:32px;\n    color:white;\n    border-radius:6px;\n    font-size:15px;\n    font-weight:bold;\n    background:#717C90;\n    padding: 0 20px;\n    cursor: pointer;\n    display:flex;\n    margin-left: 16px;\n    justify-content:center;\n    align-items:center;\n`;\n\nexport {BasicAuthority};\n"]},"metadata":{},"sourceType":"module"}