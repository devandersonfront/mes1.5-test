{"ast":null,"code":"import _taggedTemplateLiteral from \"/Users/user/Desktop/sizl/mono_pop/node_modules/next/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport _defineProperty from \"/Users/user/Desktop/sizl/mono_pop/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/Users/user/Desktop/sizl/mono_pop/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"/Users/user/Desktop/sizl/mono_pop/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"/Users/user/Desktop/sizl/mono_pop/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/user/Desktop/sizl/mono_pop/packages/main/pages/mes/basic/authority/member.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    height:32px;\\n    color:white;\\n    border-radius:6px;\\n    font-size:15px;\\n    font-weight:bold;\\n    background:#717C90;\\n    padding: 0 20px;\\n    cursor: pointer;\\n    display:flex;\\n    margin-left: 16px;\\n    justify-content:center;\\n    align-items:center;\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from 'react';\nimport MenuNavigation from '../../../../component/MenuNav/MenuNavigation';\nimport ProfileHeader from '../../../../component/Profile/ProfileHeader';\nimport { ContainerWrapper } from '../../../../styles/styledComponents';\nimport { AUTHORITY_LIST, MAX_VALUE } from '../../../../common/configset';\nimport { RequestMethod } from '../../../../common/RequestFunctions';\nimport Notiflix from 'notiflix';\nimport styled from 'styled-components';\nimport { useRouter } from 'next/router';\nvar title = '권한 관리';\n\nvar AuthorityContainer = function AuthorityContainer() {\n  _s();\n\n  var _useState = useState([]),\n      row = _useState[0],\n      setRow = _useState[1];\n\n  var _useState2 = useState(AUTHORITY_LIST),\n      auth = _useState2[0],\n      setAuth = _useState2[1];\n\n  var _useState3 = useState(-1),\n      selectIndex = _useState3[0],\n      setSelectIndex = _useState3[1];\n\n  var router = useRouter();\n  useEffect(function () {\n    loadAuthorityList().then(function () {\n      return Notiflix.Loading.remove();\n    });\n  }, []);\n\n  var loadAuthorityList = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              Notiflix.Loading.circle();\n              _context.next = 3;\n              return RequestMethod('get', 'authorityList', {\n                path: {\n                  page: 1,\n                  renderItem: MAX_VALUE\n                }\n              });\n\n            case 3:\n              res = _context.sent;\n\n              if (res && res.status === 200) {\n                setRow(_toConsumableArray(res.results.info_list));\n              } else if (res.state === 401) {\n                Notiflix.Report.failure('불러올 수 없습니다.', '권한이 없습니다.', '확인', function () {\n                  router.back();\n                });\n              }\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function loadAuthorityList() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var changeListToAuth = function changeListToAuth(list) {\n    var tmpMenu = auth;\n\n    var MenuDivide = function MenuDivide(dmenu) {\n      var tmp = dmenu;\n      if (tmp.value) tmp.check = list.indexOf(tmp.value) !== -1; // using stack structure, recursively add authorities\n\n      tmp.child = tmp.child.map(function (inner) {\n        return MenuDivide(inner);\n      });\n      var cnt = 0;\n\n      if (tmp.child.length !== 0) {\n        tmp.child.map(function (inner) {\n          if (inner.check) cnt++;\n        });\n        tmp.check = tmp.child.length === cnt;\n      }\n\n      return tmp;\n    };\n\n    tmpMenu = tmpMenu.map(function (menu) {\n      return MenuDivide(menu);\n    });\n    setAuth(_toConsumableArray(tmpMenu));\n  };\n\n  var changeAuthToList = function changeAuthToList(index) {\n    var tmpAuth = [];\n\n    var checkAuth = function checkAuth(dmenu) {\n      if (dmenu.value && dmenu.checkable && dmenu.check) {\n        tmpAuth.push(dmenu.value);\n      }\n\n      dmenu.child.map(function (inner) {\n        return checkAuth(inner);\n      });\n    };\n\n    auth.map(function (menu) {\n      checkAuth(menu);\n    });\n    return tmpAuth;\n  };\n\n  var updateAuth = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(data) {\n      var updatedAuthorities;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!data.ca_id) {\n                _context3.next = 4;\n                break;\n              }\n\n              updatedAuthorities = changeAuthToList(data.authorities);\n              _context3.next = 4;\n              return RequestMethod('put', 'authorityUpdate', _objectSpread(_objectSpread({}, data), {}, {\n                authorities: updatedAuthorities\n              })).then( /*#__PURE__*/function () {\n                var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(res) {\n                  return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          if (!(res.status === 200)) {\n                            _context2.next = 3;\n                            break;\n                          }\n\n                          _context2.next = 3;\n                          return new Promise(function (resolve) {\n                            changeListToAuth(updatedAuthorities); // update row datum\n\n                            var temporaryRows = row;\n                            temporaryRows[selectIndex].authorities = updatedAuthorities;\n                            setRow(_toConsumableArray(temporaryRows));\n                            resolve(true);\n                          }).then(function () {\n                            return Notiflix.Report.success('저장 성공!', '권한이 성공적으로 변경됐습니다.', '확인', function () {\n                              loadAuthorityList().then(function () {\n                                return Notiflix.Loading.remove();\n                              });\n                            });\n                          });\n\n                        case 3:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _callee2);\n                }));\n\n                return function (_x2) {\n                  return _ref3.apply(this, arguments);\n                };\n              }());\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function updateAuth(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var createAuth = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(data) {\n      var addedAuthorities, res;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!data) {\n                _context4.next = 10;\n                break;\n              }\n\n              addedAuthorities = changeAuthToList(data.authorities);\n              _context4.next = 4;\n              return RequestMethod('post', 'authorityCreate', {\n                name: data.name,\n                authorities: addedAuthorities\n              });\n\n            case 4:\n              res = _context4.sent;\n\n              if (!(res.status === 200)) {\n                _context4.next = 8;\n                break;\n              }\n\n              _context4.next = 8;\n              return new Promise(function (resolve) {\n                changeListToAuth(addedAuthorities); // update row datum\n\n                var temporaryRows = row;\n                temporaryRows[selectIndex].authorities = addedAuthorities;\n                setRow(_toConsumableArray(temporaryRows));\n                resolve(true);\n              }).then(function () {\n                return Notiflix.Report.success('저장 성공!', '권한이 성공적으로 등록됐습니다.', '확인', function () {\n                  loadAuthorityList().then(function () {\n                    return Notiflix.Loading.remove();\n                  });\n                });\n              });\n\n            case 8:\n              _context4.next = 11;\n              break;\n\n            case 10:\n              Notiflix.Report.failure('권한 없음', '권한을 선택해주세요', '확인');\n\n            case 11:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function createAuth(_x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var deleteAuth = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var res, tmpRow;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!(selectIndex !== -1 && row[selectIndex].ca_id)) {\n                _context5.next = 7;\n                break;\n              }\n\n              _context5.next = 3;\n              return RequestMethod('delete', 'authorityDelete', {\n                ca_id: row[selectIndex].ca_id\n              });\n\n            case 3:\n              res = _context5.sent;\n\n              if (res.status === 200) {\n                Notiflix.Report.success('삭제 성공!', '권한이 성공적으로 삭제됐습니다.', '확인', function () {\n                  loadAuthorityList().then(function () {\n                    Notiflix.Loading.remove();\n                  });\n                });\n              }\n\n              _context5.next = 10;\n              break;\n\n            case 7:\n              tmpRow = row;\n              tmpRow.splice(selectIndex, 1);\n              setRow(_toConsumableArray(tmpRow));\n\n            case 10:\n              setSelectIndex(-1);\n\n            case 11:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function deleteAuth() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var addRow = function addRow() {\n    setRow([].concat(_toConsumableArray(row), [{\n      ca_id: \"\",\n      name: '',\n      authorities: []\n    }]));\n  };\n\n  var leftButtonOnClick = function leftButtonOnClick(index) {\n    switch (index) {\n      case 0:\n        return addRow();\n\n      case 1:\n        return deleteAuth();\n    }\n  };\n\n  var saveAppointmentAuthorityDetails = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              Notiflix.Loading.hourglass('권한을 저장하고 있습니다..');\n              new Promise( /*#__PURE__*/function () {\n                var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(resolve) {\n                  return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n                    while (1) {\n                      switch (_context6.prev = _context6.next) {\n                        case 0:\n                          if (!(selectIndex !== -1 && row[selectIndex].ca_id)) {\n                            _context6.next = 5;\n                            break;\n                          }\n\n                          _context6.next = 3;\n                          return updateAuth(row[selectIndex]);\n\n                        case 3:\n                          _context6.next = 7;\n                          break;\n\n                        case 5:\n                          _context6.next = 7;\n                          return createAuth(row[selectIndex]);\n\n                        case 7:\n                          resolve(true);\n\n                        case 8:\n                        case \"end\":\n                          return _context6.stop();\n                      }\n                    }\n                  }, _callee6);\n                }));\n\n                return function (_x4) {\n                  return _ref7.apply(this, arguments);\n                };\n              }()).then(function () {\n                return Notiflix.Loading.remove(1000);\n              });\n\n            case 2:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7);\n    }));\n\n    return function saveAppointmentAuthorityDetails() {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    style: {\n      display: 'flex'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 5\n    }\n  }, __jsx(MenuNavigation, {\n    pageType: 'BASIC',\n    subType: 0,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 7\n    }\n  }), __jsx(ContainerWrapper, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }\n  }, __jsx(ProfileHeader, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 9\n    }\n  })));\n};\n\n_s(AuthorityContainer, \"d6jQX6OMN6jJDjoB6jEz7uAl4+c=\", false, function () {\n  return [useRouter];\n});\n\n_c = AuthorityContainer;\nvar HeaderButton = styled.button(_templateObject());\nexport default AuthorityContainer;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthorityContainer\");","map":{"version":3,"sources":["/Users/user/Desktop/sizl/mono_pop/packages/main/pages/mes/basic/authority/member.tsx"],"names":["React","useEffect","useState","MenuNavigation","ProfileHeader","ContainerWrapper","AUTHORITY_LIST","MAX_VALUE","RequestMethod","Notiflix","styled","useRouter","title","AuthorityContainer","row","setRow","auth","setAuth","selectIndex","setSelectIndex","router","loadAuthorityList","then","Loading","remove","circle","path","page","renderItem","res","status","results","info_list","state","Report","failure","back","changeListToAuth","list","tmpMenu","MenuDivide","dmenu","tmp","value","check","indexOf","child","map","inner","cnt","length","menu","changeAuthToList","index","tmpAuth","checkAuth","checkable","push","updateAuth","data","ca_id","updatedAuthorities","authorities","Promise","resolve","temporaryRows","success","createAuth","addedAuthorities","name","deleteAuth","tmpRow","splice","addRow","leftButtonOnClick","saveAppointmentAuthorityDetails","hourglass","display","HeaderButton","button"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react'\nimport ExcelTable from '../../../../component/Excel/ExcelTable'\nimport MenuNavigation from '../../../../component/MenuNav/MenuNavigation'\nimport ProfileHeader from '../../../../component/Profile/ProfileHeader'\nimport PageHeader from '../../../../component/Header/Header'\nimport { ContainerWrapper } from '../../../../styles/styledComponents'\nimport TreeViewTable from '../../../../component/TreeView/TreeView'\nimport {AUTHORITY_LIST, MAX_VALUE} from '../../../../common/configset'\nimport { IMenu } from '../../../../common/@types/type'\nimport { requestApi, RequestMethod } from '../../../../common/RequestFunctions'\nimport cookies from 'next-cookies'\nimport TextEditor from '../../../../component/InputBox/ExcelBasicInputBox'\nimport Notiflix from 'notiflix'\nimport { AxiosResponse } from \"axios\";\nimport styled from 'styled-components'\nimport ExcelDownloadModal from '../../../../component/Modal/ExcelDownloadMoadal'\nimport {useRouter} from 'next/router'\n\nconst title = '권한 관리'\nconst AuthorityContainer = () => {\n  const [row, setRow] = useState<Array<any>>([])\n  const [auth, setAuth] = useState<Array<IMenu>>(AUTHORITY_LIST)\n  const [selectIndex, setSelectIndex] = useState<number>(-1)\n\n  const router = useRouter()\n\n  useEffect(() => {\n    loadAuthorityList().then(() => Notiflix.Loading.remove())\n  }, [])\n\n  const loadAuthorityList = async () => {\n    Notiflix.Loading.circle()\n    const res = await RequestMethod('get', 'authorityList',\n      {\n       path: {\n         page: 1,\n         renderItem: MAX_VALUE\n       }\n      })\n\n    if(res && res.status === 200) {\n      setRow([...res.results.info_list])\n    }else if (res.state === 401) {\n      Notiflix.Report.failure('불러올 수 없습니다.', '권한이 없습니다.', '확인', () => {\n        router.back()\n      })\n    }\n  }\n\n  const changeListToAuth = (list: string[]) => {\n    let tmpMenu = auth\n    const MenuDivide = (dmenu: IMenu) => {\n      let tmp = dmenu\n      if (tmp.value) tmp.check = list.indexOf(tmp.value) !== -1;\n      // using stack structure, recursively add authorities\n      tmp.child = tmp.child.map(inner => MenuDivide(inner))\n\n      let cnt = 0\n      if (tmp.child.length !== 0) {\n        tmp.child.map(inner => {\n          if (inner.check) cnt++\n        })\n        tmp.check = tmp.child.length === cnt;\n      }\n\n      return tmp\n    }\n\n    tmpMenu = tmpMenu.map(menu => MenuDivide(menu))\n    setAuth([...tmpMenu])\n  }\n\n  const changeAuthToList = (index: number) => {\n    let tmpAuth: string[] = []\n\n    const checkAuth = (dmenu: IMenu) => {\n      if(dmenu.value && dmenu.checkable && dmenu.check) {\n        tmpAuth.push(dmenu.value)\n      }\n\n      dmenu.child.map(inner => {\n        return checkAuth(inner)\n      })\n    }\n\n    auth.map(menu => {\n      checkAuth(menu)\n    })\n\n    return tmpAuth\n  }\n\n  const updateAuth = async (data: any) => {\n    if(data.ca_id){\n      const updatedAuthorities = changeAuthToList(data.authorities)\n      await RequestMethod('put', 'authorityUpdate', {\n        ...data,\n        authorities: updatedAuthorities\n      }).then(async (res: AxiosResponse) => {\n        if (res.status === 200){\n          await new Promise((resolve) => {\n            changeListToAuth(updatedAuthorities)\n            // update row datum\n            let temporaryRows = row\n            temporaryRows[selectIndex].authorities = updatedAuthorities\n            setRow([ ...temporaryRows])\n            resolve(true)\n          }).then(() =>Notiflix.Report.success('저장 성공!', '권한이 성공적으로 변경됐습니다.', '확인', () => {\n            loadAuthorityList().then(() => Notiflix.Loading.remove())\n          }))\n        }\n      })\n    }\n  }\n\n  const createAuth = async (data: any) => {\n    if(data){\n      const addedAuthorities = changeAuthToList(data.authorities)\n      const res = await RequestMethod('post', 'authorityCreate', {\n        name: data.name,\n        authorities: addedAuthorities\n      })\n\n      if (res.status === 200){\n        await new Promise((resolve) => {\n          changeListToAuth(addedAuthorities)\n          // update row datum\n          let temporaryRows = row\n          temporaryRows[selectIndex].authorities = addedAuthorities\n          setRow([ ...temporaryRows])\n          resolve(true)\n        }).then(() => Notiflix.Report.success('저장 성공!', '권한이 성공적으로 등록됐습니다.', '확인', () => {\n          loadAuthorityList().then(() => Notiflix.Loading.remove())\n        }))\n      }\n    } else {\n      Notiflix.Report.failure('권한 없음', '권한을 선택해주세요', '확인')\n    }\n  }\n\n  const deleteAuth = async () => {\n    if(selectIndex !== -1 && row[selectIndex].ca_id){\n      const res = await RequestMethod('delete', 'authorityDelete', {\n        ca_id: row[selectIndex].ca_id\n      })\n\n      if (res.status === 200){\n        Notiflix.Report.success('삭제 성공!', '권한이 성공적으로 삭제됐습니다.', '확인', () => {\n          loadAuthorityList().then(() => {\n            Notiflix.Loading.remove()\n          })\n        })\n      }\n    } else {\n      let tmpRow = row\n      tmpRow.splice(selectIndex, 1)\n\n      setRow([...tmpRow])\n    }\n    setSelectIndex(-1)\n  }\n\n  const addRow = () => {\n    setRow([...row, {\n      ca_id: \"\",\n      name: '',\n      authorities: []\n    }])\n  }\n\n  const leftButtonOnClick = (index: number) => {\n    switch(index){\n      case 0:\n        return addRow()\n      case 1:\n        return deleteAuth()\n    }\n  }\n\n  const saveAppointmentAuthorityDetails = async () => {\n    Notiflix.Loading.hourglass('권한을 저장하고 있습니다..')\n    new Promise( async (resolve) => {\n      if (selectIndex !== -1 && row[selectIndex].ca_id) {\n        await updateAuth(row[selectIndex])\n      } else {\n        await createAuth(row[selectIndex])\n      }\n      resolve(true)\n    }).then(() => Notiflix.Loading.remove(1000))\n  }\n\n  return (\n    <div style={{display: 'flex'}}>\n      <MenuNavigation pageType={'BASIC'} subType={0}/>\n      <ContainerWrapper>\n        <ProfileHeader/>\n\n      </ContainerWrapper>\n    </div>\n  );\n}\n\nconst HeaderButton = styled.button`\n    height:32px;\n    color:white;\n    border-radius:6px;\n    font-size:15px;\n    font-weight:bold;\n    background:#717C90;\n    padding: 0 20px;\n    cursor: pointer;\n    display:flex;\n    margin-left: 16px;\n    justify-content:center;\n    align-items:center;\n`;\n\nexport default AuthorityContainer;\n\n"]},"metadata":{},"sourceType":"module"}